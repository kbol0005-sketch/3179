{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 600,
  "projection": {"type": "mercator"},
  "title": {
    "text": "Recovery of Domestic Air Travel in Australia (2024 vs 2019)",
    "fontSize": 18,
    "fontWeight": "bold",
    "anchor": "middle",
    "color": "#333333",
    "offset": 20
  },
  "layer": [
    {
      "data": {
        "url": "australia_states.topojson",
        "format": {"type": "topojson", "feature": "ne_50m_admin_1_states_provinces"}
      },
      "layer": [
        {
          "mark": {
            "type": "geoshape",
            "fill": "#f7f3e9",
            "stroke": "333333",
            "strokeOpacity": 0.8,
            "strokeWidth": 0.3
          }
        },
        {
          "transform": [
            {
              "calculate": "datum.properties.name === 'Australian Capital Territory' ? 'ACT' : datum.properties.name",
              "as": "state_label"
            }
          ],
          "mark": {"type": "text", "fontSize": 10, "color": "#a6a6a6"},
          "encoding": {
            "longitude": {"field": "properties.longitude", "type": "quantitative"},
            "latitude": {"field": "properties.latitude", "type": "quantitative"},
            "text": {"field": "state_label"}
          }
        }
      ]
    },
    {
      "data": {
        "url": "australia_routes_lines.geojson",
        "format": {"type": "json", "property": "features"}
      },
      "mark": {
        "type": "geoshape",
        "strokeOpacity": 0.3,
        "stroke": "black",
        "strokeWidth": 0.3
      },
      "encoding": {
        "color": {
          "field": "properties.change",
          "type": "quantitative",
          "scale": {
            "type": "threshold",
            "domain": [-0.15, -0.05, 0.05, 0.15],
            "range": ["#d73027", "#ef8a62", "#92c5de", "#66bd63", "#1a9850"]
          },
          "title": "Traffic Change (%)",
          "legend": {"format": ".0%"}
        },
        "tooltip": [
          {"field": "properties.origin", "title": "Origin"},
          {"field": "properties.destination", "title": "Destination"},
          {"field": "properties.passengers", "title": "Passengers", "format": ","},
          {"field": "properties.flights", "title": "Flights", "format": ","},
          {"field": "properties.lf", "title": "Load Factor", "format": ".0%"},
          {"field": "properties.change", "title": "Change in Traffic", "format": ".0%"}
        ]
      }
    },
    {
      "data": {
        "url": "australia_airports.topojson",
        "format": {"type": "topojson", "feature": "ne_10m_airports"}
      },
      "layer": [
        {
          "mark": {
            "type": "circle",
            "color": "#1f78b4",
            "stroke": "#333333",
            "strokeWidth": 0.3,
            "size": 60
          },
          "encoding": {
            "longitude": {"field": "properties.LON"},
            "latitude": {"field": "properties.LAT"},
            "tooltip": [
              {"field": "properties.name", "title": "Airport"},
              {"field": "properties.iata_code", "title": "IATA"}
            ]
          }
        },
        {
          "transform": [
            {
              "lookup": "properties.iata_code",
              "from": {
                "data": {
                  "values": [
                    {"iata": "SYD", "city": "Sydney", "dx": 8, "dy": -1},
                    {"iata": "MEL", "city": "Melbourne", "dx": -9, "dy": -3},
                    {"iata": "BNE", "city": "Brisbane", "dx": 10, "dy": 1},
                    {"iata": "OOL", "city": "Gold Coast", "dx": 11, "dy": -1},
                    {"iata": "ADL", "city": "Adelaide", "dx": -9, "dy": -3},
                    {"iata": "PER", "city": "Perth", "dx": -7, "dy": 0},
                    {"iata": "HBA", "city": "Hobart", "dx": 9, "dy": 0},
                    {"iata": "CBR", "city": "Canberra", "dx": 0, "dy": -4},
                    {"iata": "CNS", "city": "Cairns", "dx": 8, "dy": 0},
                    {"iata": "DRW", "city": "Darwin", "dx": -8, "dy": 0}
                  ]
                },
                "key": "iata",
                "fields": ["city", "dx", "dy"]
              }
            },
            {"calculate": "datum.properties.LON + datum.dx*0.2", "as": "LON_shift"},
            {"calculate": "datum.properties.LAT + datum.dy*0.2", "as": "LAT_shift"}
          ],
          "mark": {"type": "text", "fontSize": 10, "color": "#2c3e50", "fontWeight": "bold"},
          "encoding": {
            "longitude": {"field": "LON_shift"},
            "latitude": {"field": "LAT_shift"},
            "text": {"field": "city"}
          }
        }
      ]
    }
  ],
  "config": {
    "view": {"stroke": null},
    "background": "white"
  }
}